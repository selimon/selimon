var FH="object"==typeof FH?FH:{};FH["freelancehunt-io-all"]=function(e){function n(n){for(var t,l,d=n[0],s=n[1],r=n[2],f=0,u=[];f<d.length;f++)l=d[f],a[l]&&u.push(a[l][0]),a[l]=0;for(t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);for(c&&c(n);u.length;)u.shift()();return i.push.apply(i,r||[]),o()}function o(){for(var e,n=0;n<i.length;n++){for(var o=i[n],t=!0,d=1;d<o.length;d++){var s=o[d];0!==a[s]&&(t=!1)}t&&(i.splice(n--,1),e=l(l.s=o[0]))}return e}var t={},a={7:0},i=[];function l(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,l),o.l=!0,o.exports}l.m=e,l.c=t,l.d=function(e,n,o){l.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,n){if(1&n&&(e=l(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(l.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)l.d(o,t,function(n){return e[n]}.bind(null,t));return o},l.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(n,"a",n),n},l.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},l.p="/static/dist/";var d=window.webpackJsonp=window.webpackJsonp||[],s=d.push.bind(d);d.push=n,d=d.slice();for(var r=0;r<d.length;r++)n(d[r]);var c=s;return i.push(["7gd6",0,24]),o()}({0:function(e,n){},"7gd6":function(e,n,o){"use strict";o.r(n);var t=o("/X3o"),a=o("gFX4"),i=o("ymdT");!function(){if(a&&Freelancehunt.config.ioEnabled){var e=$("#my-feed-menu"),n=$("#unread-messages-link"),o=$("#unread-feed-count"),l=$("[data-unread-message-count]"),d=new t({animation:"fade",bgColor:"#eee",textColor:"#000"}),s=function(){var e=parseInt(l.html())+parseInt(o.html());d.badge(e)},r="fhToken="+Freelancehunt.profile.token;$("[data-presence-ids]").length&&(r+="&presenceIds="+$("[data-presence-ids]").data("presence-ids")),Freelancehunt.socket=a.connect(Freelancehunt.config.ioHost,{query:r}),Freelancehunt.socket.on("connect",function(){console.log("⚡ Live updates enabled"),$("#io-enabled").addClass("in")}).on("unread threads",function(e){var o=e.thread_ids.length;Freelancehunt.profile.threadId&&-1!==$.inArray(Freelancehunt.profile.threadId,e.thread_ids)||(console.log("Unread thread count changed to "+o),function(e){var o=parseInt(l.html());if(e!=o){if(l.html(e),0===e?l.addClass("hidden"):l.removeClass("hidden"),e>o){for(var t=0;t<3;t++)n.animate({opacity:.2},500),n.animate({opacity:1},500);$("#profile-logged-in").data("is-send-pm-audio-notify")&&i.a.play(Freelancehunt.profile.soundName)}s(),console.log("📨 messages "+o+" → "+e)}}(o))}).on("feed updated",function(){!function(){var n=parseInt(o.html())+1;o.html(n).removeClass("hidden");for(var t=0;t<3;t++)e.animate({opacity:.25},500),e.animate({opacity:1},500);s(),console.log("🗞️ incremented feed item count to "+n)}(),console.log("Feed updated")}).on("online",function(e){var n=$("[data-presence-for-profile-id="+e.profileId+"]");n.hasClass("offline")&&(n.removeClass("offline").addClass("online").attr("data-original-title","Сейчас онлайн"),$("[data-require-presence-profile-id]").removeAttr("disabled"))}).on("offline",function(e){var n=$("[data-presence-for-profile-id="+e.profileId+"]");n.hasClass("online")&&(n.removeClass("online").addClass("offline").attr("data-original-title","Не в сети"),$("[data-require-presence-profile-id]").attr("disabled","disabled"))}).on("feed read",function(){console.log("Feed read event"),parseInt(o.html())>0&&(o.html(0).addClass("hidden"),s(),console.log("feed marked as read"))}).on("money received",function(){i.a.play("cha-ching"),console.log("Money received")}),window.setInterval(function(){"undefined"==typeof Visibility||Visibility.hidden()||Freelancehunt.socket.emit("heart beat")},15e3)}else console.log("Live updates not available")}();var l=o("i5cm"),d=o.n(l);function s(e){var n=$("#reply-form"),o=function(e){return e>9?e:"0"+e},t=new d.a.AccessToken(e);t.on("expired",function(e){console.log("token expired, renewing",e),$.get("/profile/dorefreshwebrtctoken",function(n){e.update(n)})}),console.log("obtained:",t);var a=new d.a.Signal(t),l=new d.a.Video(a),s=function(){return void 0!==l.sessions.keys};a.on("message",function(e){console.log("✉️ message received:",e);var o=e.type,t=e.from;if("invite"===o){var d=e.data,r=t.split("/")[0].toString();if(console.log("invite from profile",r,"to join session",d),$(".modal.in").length){if(s())return void console.log("active modal detected with ongoing call, rejecting new invite");console.log("active modal detected, but call not active -- hiding old modal"),$(".modal.in").modal("hide")}var c=$("#fh-webrtc-modal").clone(),f=new Audio("/static/audio/incoming-call.mp3");f.loop=!0,$.getJSON("/profile/dofetchcallrecipient/id/"+r,function(e){c.on("show.bs.modal",function(n){var o=$(this);o.find(".modal-title").text("Входящий вызов от "+e.login),o.find("[data-caller-photo]").attr("src",e.photo),o.find("[data-caller-name]").text(e.full_name),o.find("[data-reject-call], [data-accept-call]").removeClass("hidden"),f.play(),o.one("click","[data-accept-call]",function(){l.join(d,function(e,n){n.me.publish({audio:!0,video:!1})}),$(this).addClass("hidden"),o.find("[data-reject-call]").addClass("hidden"),o.find("[data-disconnect-call]").removeClass("hidden"),f.pause()}),o.one("click","[data-disconnect-call]",function(){for(var e in l.sessions)l.sessions[e].leave();o.modal("hide")}),o.one("click","[data-reject-call]",function(){a.send({to:t,type:"reject"}),o.modal("hide")})}).on("hidden.bs.modal",function(){s()&&(n.find("[data-disconnect-call]").removeClass("hidden"),n.find(".minutes").removeClass("hidden"),$("[data-call-profile-id]").addClass("hidden"),n.one("click","[data-disconnect-call]",function(){for(var e in l.sessions)l.sessions[e].leave()})),c.remove(),$("[data-call-profile-id]").removeClass("disabled"),f.pause()}).modal("show")})}else"reject"===o&&(console.log("call rejected"),$(".modal.in").modal("hide"),i.a.warn("Звонок отклонен"))}),l.on("session",function(e,t){console.log("Video session operation:",t,"session:",e),t>0?(console.log("session created",e),e.on("participant",function(t,a){if(console.log("👤 session participant",t.id,"with operation",a),a>0){t.subscribe({audio:!0,video:!1});var i=0,l=$(".modal.in"),d=l.find("[data-call-duration]").removeClass("hidden");setInterval(function(){d.find(".seconds").html(o(++i%60)),d.find(".minutes").html(o(parseInt(i/60,10))),n.find(".seconds").html(o(i%60)),n.find(".minutes").html(o(parseInt(i/60,10)))},1e3),l.find("[data-caller-photo]").removeClass("pulse")}else a<0&&e.leave()}),e.me.publish({audio:!0,video:!1})):0===t?console.log("session updated",e):t<0&&(console.log("session removed",e),$(".modal.in").modal("hide"))}),$("[data-call-profile-id]").addClass("in").on("click",function(e){e.preventDefault(),$(this).addClass("disabled");var o=$(this).data("call-profile-id").toString();$.getJSON("/profile/dofetchcallrecipient/id/"+o,function(e){l.create({mode:"p2p"},function(t,i){t&&console.warn("session creation failed:",t),console.log("session created:",i.id),a.send({to:o,type:"invite",data:i.id});var l=$("#fh-webrtc-modal").clone();l.on("show.bs.modal",function(){l.find(".modal-title").text("Набираем "+e.login+"..."),l.find("[data-caller-photo]").attr("src",e.photo),l.find("[data-caller-name]").text(e.full_name),l.find("[data-disconnect-call]").removeClass("hidden"),l.one("click","[data-disconnect-call]",function(){i.leave()})}).on("hidden.bs.modal",function(){s()&&(n.find("[data-disconnect-call]").removeClass("hidden"),n.find(".minutes").removeClass("hidden"),$("[data-call-profile-id]").addClass("hidden"),n.one("click","[data-disconnect-call]",function(){i.leave()})),l.remove(),$("[data-call-profile-id]").removeClass("disabled")}).modal("show")})})})}!function(){if(window.bit6&&Freelancehunt.profile.threadId){if(!window.sessionStorage)return void console.warn("sessionStorage is not available");var e=sessionStorage.getItem("webrtcToken");e?(console.log("using cached webrtc token"),new s(e)):$.get("/profile/dorefreshwebrtctoken",function(e){console.log("fetching new webrtc token"),sessionStorage.setItem("webrtcToken",e),new s(e)})}}()},xeH2:function(e,n){e.exports=jQuery},ymdT:function(e,n,o){"use strict";var t=o("+PDW");function a(e){var n=Object.assign({shadow:!1,styling:"fontawesome",delay:2500},e),o=new t(n);o.get().click(function(){o.remove()})}n.a={warn:function(e){a({type:"notice",text:e})},success:function(e){a({type:"success",text:e,after_init:function(e){e.attention("pulse")}})},error:function(e){a({type:"error",text:e})},play:function(e){var n="/static/audio/"+e;$("body").append('<audio autoplay="autoplay"><source src="'+n+'.mp3" type="audio/mpeg" /><source src="'+n+'.ogg" type="audio/ogg" /><embed hidden="true" autostart="true" loop="false" src="'+n+'.mp3" /></audio>')}}}});